{

  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "{alarmName}": {
      "Type": "AWS::CloudWatch::Alarm",
      "Properties": {
        "AlarmName": "{resName} - Alarm",
        "ActionsEnabled": false,
        "OKActions": [],
        "AlarmActions": [
          "{snsTopic}"
        ],
        "InsufficientDataActions": [],
        "Dimensions": [],
        "EvaluationPeriods": 1,
        "DatapointsToAlarm": 1,
        "Threshold": 3,
        "ComparisonOperator": "GreaterThanThreshold",
        "TreatMissingData": "notBreaching",
        "Metrics": [
          {
            "Id": "e1",
            "Label": "Error Percentage",
            "ReturnData": true,
            "Expression": "((m2 + m3)/m1) * 100"
          },
          {
            "Id": "m2",
            "ReturnData": false,
            "MetricStat": {
              "Metric": {
                "Namespace": "AWS/ApiGateway",
                "MetricName": "4xx",
                "Dimensions": [
                  {
                    "Name": "Stage",
                    "Value": "$default"
                  },
                  {
                    "Name": "Method",
                    "Value": "{method}"
                  },
                  {
                    "Name": "Resource",
                    "Value": "{resName}"
                  },
                  {
                    "Name": "ApiId",
                    "Value": "{apiId}"
                  }
                ]
              },
              "Period": 60,
              "Stat": "Sum"
            }
          },
          {
            "Id": "m3",
            "ReturnData": false,
            "MetricStat": {
              "Metric": {
                "Namespace": "AWS/ApiGateway",
                "MetricName": "5xx",
                "Dimensions": [
                  {
                    "Name": "Stage",
                    "Value": "$default"
                  },
                  {
                    "Name": "Method",
                    "Value": "{method}"
                  },
                  {
                    "Name": "Resource",
                    "Value": "{resName}"
                  },
                  {
                    "Name": "ApiId",
                    "Value": "{apiId}"
                  }
                ]
              },
              "Period": 60,
              "Stat": "Sum"
            }
          },
          {
            "Id": "m1",
            "Label": "Invocations",
            "ReturnData": false,
            "MetricStat": {
              "Metric": {
                "Namespace": "AWS/ApiGateway",
                "MetricName": "Count",
                "Dimensions": [
                  {
                    "Name": "Stage",
                    "Value": "$default"
                  },
                  {
                    "Name": "Method",
                    "Value": "{method}"
                  },
                  {
                    "Name": "Resource",
                    "Value": "{resName}"
                  },
                  {
                    "Name": "ApiId",
                    "Value": "{apiId}"
                  }
                ]
              },
              "Period": 60,
              "Stat": "Sum"
            }
          }
        ]
      }
    }
  }

}